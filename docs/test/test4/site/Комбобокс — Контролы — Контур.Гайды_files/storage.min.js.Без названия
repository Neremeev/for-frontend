!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a,b){window.parent.postMessage(JSON.stringify(a),b),window.parent.postMessage(a,b)}function e(a){var b;if(a.data){if("string"==typeof a.data)try{b=JSON.parse(a.data)}catch(c){return}else b=a.data;if(b&&"MBR_STORAGE"===b.type)switch(m.version||m.init(),b.command){case"get":b.value=m.get(b.key,b.session),d(b,a.origin);break;case"set":m.set(b.key,b.value,b.session),d(b,a.origin);break;case"remove":m.remove(b.key),d(b,a.origin);break;case"loadSettings":b.value=m.loadSettings(),m.synchronize(function(){d(b,a.origin)});break;case"loadPartnerSettings":b.value=m.loadSettings(),m.synchronize(function(){d(b,a.origin)});break;case"loadUserSettings":b.value=m.loadSettings(!0),m.synchronize(function(){d(b,a.origin)});break;case"saveSettings":m.saveSettings(b.value);break;case"getSelector":b.value=m.getSelector(b.domain),d(b,a.origin);break;case"testStorage":b.value=m.testStorage(),d(b,a.origin);break;case"getCookies":b.value=m.getCookies(),d(b,a.origin);break;case"getLocalStorage":b.value=m.getLocalStorage(),d(b,a.origin);break;case"getDomainInfo":b.domains?(localStorage.setItem("useDomainsData",!0),localStorage.removeItem("blacklist"),localStorage.removeItem("selectors"),"string"==typeof b.domains&&(b.domains=JSON.parse(b.domains)),m.getDomainInfo(b.domains).then(function(c){b.value=c,d(b,a.origin)})):d(b,a.origin)}}}c(1),c(2);var f=c(5),g=c(10),h=c(11),i=c(4),j=c(12),k=c(3),l=c(6),m={init:function(){this._indexedDBStorage=new l,this.version=3,this.set("version",this.version)},get:function(a,b){if("cookies"===a)return this.getCookies();if("localStorage"===a)return this.getLocalStorage();var c=null;if(b)c=f.get(a);else try{var d=localStorage.getItem(a);if(d&&(c=JSON.parse(d),"clientId"===a)){var e=new Date((new Date).getTime()+31536e6);f.set(a,d,e,"/")}}catch(g){}return c},set:function(a,b,c){try{if(c)f.set(a,b,null,"/");else{var d=JSON.stringify(b);localStorage.setItem(a,d)}}catch(e){}return b},remove:function(a){try{localStorage.removeItem(a)}catch(b){}},_saveSettingsParam:function(a,b){var c=new Date((new Date).getTime()+12096e5);f.set(a,b,c,"/")},_getSettingsParam:function(a,b){b=b||"";var c=f.get(b+a);return c?(c=unescape(c),"true"!==c&&"false"!==c?c:"true"===c):(c=localStorage.getItem(a))?JSON.parse(c):null},saveSettings:function(a){if(a){var b=this._getSettingsParam("affId"),c=this._getSettingsParam("clid"),d=!b&&!c;if(d||(1048==b?d=a.affId==b:c?d=c==a.clid:b&&(d=b==a.affId)),d)for(var e in a)this._saveSettingsParam(e,a[e])}},loadSettings:function(a){for(var b,c={},d=a?"user-":"",e=["affId","clid","applicationName","offerEnabled","affSource","affSub","source","autoShowShopList","mbrApplication","statsDisabled"],f=0;f<e.length;f++)b=this._getSettingsParam(e[f],d),null!==b&&void 0!==b&&(c[e[f]]=b);return c},getSelector:function(a){var b=localStorage.getItem("selectors");if(b&&(b=JSON.parse(k(b)))){var c,d=null;for(b[a]&&(c=b[a],d=!1);-1!=a.indexOf(".");)if(a=a.substr(a.indexOf(".")+1),b[a]){c=j.defaults(c,b[a]),null===d&&(d=!0);break}if(c){if(c.nameSelector||c.priceSelector||c.currencySelector)return c;if("review"===c.type&&!d)return c}}return null},getCookies:function(){return document.cookie.split(";").map(function(a){return"|"+a.replace("=","|")+"|"}).join("\n")},getLocalStorage:function(){var a="";for(var b in localStorage)"blacklist"!==b&&"selectors"!==b&&(a+="|"+b+"|"+localStorage.getItem(b)+"|\n");return a},testStorage:function(){var a=!1;try{localStorage.getItem("test"),f.get("test"),a=!0}catch(b){}return a},getDomainInfo:function(){var a=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return this._indexedDBStorage.get("domains").then(function(){var b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],c=a.find(function(a){return b[a]});return c?b[c]:void 0})},_getActualSettings:function(){var a={},b=["affId","clid","applicationName","offerEnabled","affSub","aviaEnabled","autoShowShopList","clientId","activeCity","activeCountry","otherRegions","firstStartTime","eulaAcceptTime","noRandomize","logEnabled","adultOffer"],c=this.loadSettings(!0),d=this.loadSettings();for(var e in d)d.hasOwnProperty(e)&&!c.hasOwnProperty(e)&&(c[e]=d[e]);return b.forEach(function(b){c.hasOwnProperty(b)?a[b]=c[b]:null!==this.get(b)&&(a[b]=this.get(b))}.bind(this)),null!==this.get("mbr.offerAccepted")&&(a.offerAccepted=this.get("mbr.offerAccepted")),null!==this.get("optOutAccepted")&&(a.optOutAccepted=this.get("optOutAccepted")),a.sovetnikRemoved="true"===this.get("sovetnikRemoved"),a.pricebarShown=!!this.get("firstStart"),a.otherRegions="otherRegionsDisabled"!==this.get("otherRegions"),a.affId||a.clid||(a=null),a},synchronize:function(a){var b=parseInt(this.get("syncDate"),10)||0,c=(new Date).getTime()-b>18e6&&this._getActualSettings()&&!this._syncRequestSent;if(c){this._syncRequestSent=!0;var d=g&&g.isCORSSupported()||!h?g:h,e={settings:JSON.stringify(this._getActualSettings())};d.post?d.post(i.getApiHost()+"/settings",e,function(b){this.set("syncDate",(new Date).getTime()),a()}.bind(this)):this.set("syncDate",(new Date).getTime())}else a()}};window.addEventListener?window.addEventListener("message",e,!0):window.attachEvent("onmessage",e)},function(a,b){"use strict";var c=/^[a-z]/;for(var d in localStorage)if(!c.test(d)){var e=localStorage.getItem(d);e&&e.length&&e.length>100&&localStorage.removeItem(d)}},function(a,b,c){"use strict";function d(a){var b=j.getDomainsJSONUrl().replace("domains.json","");return""+b+a}function e(){var a=(new Date).getTime()+864e5;k.set("script-data-updated","true",new Date(a),"/")}function f(){return!!k.get("script-data-updated")}function g(){var a=document.createElement("script");a.src=d("script-data.js"),a.onload=function(){window.scriptData&&!localStorage.getItem("useDomainsData")&&(localStorage.setItem("blacklist",i(JSON.stringify(scriptData.blacklist))),localStorage.setItem("selectors",JSON.stringify(scriptData.selectors)))},document.body.appendChild(a)}function h(){var a=document.createElement("script");a.src=d("domains.js"),a.onload=function(){if(window.domains){localStorage.getItem("useDomainsData")&&(localStorage.removeItem("blacklist"),localStorage.removeItem("selectors"));var a=new l;a.set("domains",window.domains).then(function(){e(),localStorage.removeItem("domains")})}},document.body.appendChild(a)}var i=c(3),j=c(4),k=c(5),l=c(6);f()||(g(),h())},function(a,b){"use strict";function c(a){var b,c,d,e,f,g,h,i="",j=0,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=k.indexOf(a.charAt(j++)),f=k.indexOf(a.charAt(j++)),g=k.indexOf(a.charAt(j++)),h=k.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));var l="";j=0;for(var m=0,n=0;j<i.length;)if(m=i.charCodeAt(j),128>m)l+=String.fromCharCode(m),j++;else if(m>191&&224>m)n=i.charCodeAt(j+1),l+=String.fromCharCode((31&m)<<6|63&n),j+=2;else{n=utftext.charCodeAt(j+1);var o=utftext.charCodeAt(j+2);l+=String.fromCharCode((15&m)<<12|(63&n)<<6|63&o),j+=3}return l}a.exports=c},function(a,b){"use strict";var c={_current:{apiHost:"%SOVETNIK_API_HOST%",storageHost:"%SOVETNIK_STORAGE_HOST%",settingsHost:"%SOVETNIK_SETTINGS_HOST%",staticHost:"%SOVETNIK_STORAGE_HOST%"},_production:{apiHost:"https://sovetnik.market.yandex.ru",storageHost:"https://dl.metabar.ru",settingsHost:"https://sovetnik.market.yandex.ru",landingHost:"https://sovetnik.yandex.ru",staticHost:"https://yastatic.net"},_isPatched:function(a){return!/^%[^%]+%$/.test(a)},_getHost:function(a){return this._current[a]&&this._isPatched(this._current[a])?this._current[a]:this._production[a]},getApiHost:function(){return this._getHost("apiHost")},getStorageHost:function(){return this._getHost("storageHost")},getSettingsURL:function(){var a=this._getHost("settingsHost");return a===this._production.settingsHost?a+"/app/settings":a+"/sovetnik"},getSettingsURLMobile:function(){var a=this._getHost("settingsHost");return a===this._production.settingsHost?a+"/mobile/settings":a+"/sovetnik-mobile"},getSettingsHost:function(){return this._getHost("settingsHost")},getClientEventUrl:function(){return this._getHost("apiHost")+"/client"},getFeedbackEventUrl:function(){return this._getHost("apiHost")+"/feedback"},getAviaFeedbackEventUrl:function(){return this._getHost("apiHost")+"/feedback-avia"},getLandingHost:function(){return this._getHost("landingHost")},getDomainsJSONUrl:function(){var a=this._getHost("staticHost")===this._production.staticHost||this._getHost("staticHost")===this._production.storageHost;return a?this._production.staticHost+"/sovetnik/_/script-data/domains.json":this._getHost("staticHost")+"/static/script-data/domains.json"},getUninstallUrl:function(){return this.getLandingHost()+"/goodbye"},getCPAOnboardingTrackingUrl:function(){return this.getApiHost()+"/cpa-onboarding"}};a.exports=c},function(a,b){"use strict";var c={set:function(a,b,c,d,e){var f=a+"="+window.escape(b)+";";c&&(c instanceof Date?window.isNaN(c.getTime())&&(c=new Date):c=new Date((new window.Date).getTime()+1e3*window.parseInt(c,10)*60*60*24),f+="expires="+c.toGMTString()+";"),d&&(f+="path="+d+";"),e&&(f+="domain="+e+";"),window.document.cookie=f},get:function(a){var b=new RegExp("(?:^"+a+"|;\\s*"+a+")=(.*?)(?:;|$)","g"),c=b.exec(window.document.cookie);return null===c?null:c[1]},remove:function(a){this.set(a,"",new Date(1970,1,1,1,1),"/")}};a.exports=c},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},h=c(7),i=c(8),j=c(9),k=function(a){function b(){var a=arguments.length<=0||void 0===arguments[0]?"sovetnik":arguments[0],c=this,e=arguments.length<=1||void 0===arguments[1]?"domains":arguments[1],f=arguments.length<=2||void 0===arguments[2]?1:arguments[2];if(d(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),!("indexedDB"in window))throw new Error("This browser doesn't support IndexedDB");this._name=a,this._storeName=e,this._version=f,this._dbPromise=h.open(this._name,this._version,function(a){c._upgradeCallback(a)})}return e(b,a),f(b,[{key:"_upgradeCallback",value:function(a){a.objectStoreNames.contains(this._storeName)||a.createObjectStore(this._storeName,{keyPath:"key"})}},{key:"get",value:function(a){var b=this;return this._dbPromise.then(function(c){var d=c.transaction(b._storeName,"readonly"),e=d.objectStore(b._storeName);return e.get(a)}).then(function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=a.key,c=a.value;return i("IndexedDBStorage['"+b+"'] : "+(c&&JSON.stringify(c).slice(0,20))+"..."),c})["catch"](function(a){throw i("Something went wrong: "+a.message),a})}},{key:"set",value:function(a,b){var c=this;return this._dbPromise.then(function(d){var e=d.transaction(c._storeName,"readwrite"),f=e.objectStore(c._storeName);return f.put({key:a,value:b}),e.complete}).then(function(){i("IndexedDBStorage['"+a+"', "+(b&&JSON.stringify(b).slice(0,20))+"...]")})["catch"](function(a){throw i("Something went wrong: "+a.message),a})}}]),b}(j);a.exports=k},function(a,b,c){"use strict";!function(){function b(a){return Array.prototype.slice.call(a)}function c(a){return new Promise(function(b,c){a.onsuccess=function(){b(a.result)},a.onerror=function(){c(a.error)}})}function d(a,b,d){var e,f=new Promise(function(f,g){e=a[b].apply(a,d),c(e).then(f,g)});return f.request=e,f}function e(a,b,c){var e=d(a,b,c);return e.then(function(a){return a?new k(a,e.request):void 0})}function f(a,b,c){c.forEach(function(c){Object.defineProperty(a.prototype,c,{get:function(){return this[b][c]},set:function(a){this[b][c]=a}})})}function g(a,b,c,e){e.forEach(function(e){e in c.prototype&&(a.prototype[e]=function(){return d(this[b],e,arguments)})})}function h(a,b,c,d){d.forEach(function(d){d in c.prototype&&(a.prototype[d]=function(){return this[b][d].apply(this[b],arguments)})})}function i(a,b,c,d){d.forEach(function(d){d in c.prototype&&(a.prototype[d]=function(){return e(this[b],d,arguments)})})}function j(a){this._index=a}function k(a,b){this._cursor=a,this._request=b}function l(a){this._store=a}function m(a){this._tx=a,this.complete=new Promise(function(b,c){a.oncomplete=function(){b()},a.onerror=function(){c(a.error)},a.onabort=function(){c(a.error)}})}function n(a,b,c){this._db=a,this.oldVersion=b,this.transaction=new m(c)}function o(a){this._db=a}f(j,"_index",["name","keyPath","multiEntry","unique"]),g(j,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(j,"_index",IDBIndex,["openCursor","openKeyCursor"]),f(k,"_cursor",["direction","key","primaryKey","value"]),g(k,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(a){a in IDBCursor.prototype&&(k.prototype[a]=function(){var b=this,d=arguments;return Promise.resolve().then(function(){return b._cursor[a].apply(b._cursor,d),c(b._request).then(function(a){return a?new k(a,b._request):void 0})})})}),l.prototype.createIndex=function(){return new j(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new j(this._store.index.apply(this._store,arguments))},f(l,"_store",["name","keyPath","indexNames","autoIncrement"]),g(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),h(l,"_store",IDBObjectStore,["deleteIndex"]),m.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},f(m,"_tx",["objectStoreNames","mode"]),h(m,"_tx",IDBTransaction,["abort"]),n.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},f(n,"_db",["name","version","objectStoreNames"]),h(n,"_db",IDBDatabase,["deleteObjectStore","close"]),o.prototype.transaction=function(){return new m(this._db.transaction.apply(this._db,arguments))},f(o,"_db",["name","version","objectStoreNames"]),h(o,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(a){[l,j].forEach(function(c){c.prototype[a.replace("open","iterate")]=function(){var c=b(arguments),d=c[c.length-1],e=this._store||this._index,f=e[a].apply(e,c.slice(0,-1));f.onsuccess=function(){d(f.result)}}})}),[j,l].forEach(function(a){a.prototype.getAll||(a.prototype.getAll=function(a,b){var c=this,d=[];return new Promise(function(e){c.iterateCursor(a,function(a){return a?(d.push(a.value),void 0!==b&&d.length==b?void e(d):void a["continue"]()):void e(d)})})})});var p={open:function(a,b,c){var e=d(indexedDB,"open",[a,b]),f=e.request;return f.onupgradeneeded=function(a){c&&c(new n(f.result,a.oldVersion,f.transaction))},e.then(function(a){return new o(a)})},"delete":function(a){return d(indexedDB,"deleteDatabase",[a])}};a.exports=p,a.exports["default"]=a.exports}()},function(a,b){"use strict";function c(){try{window.localStorage&&window.localStorage["svt.debug"]&&console.log.apply(console,arguments)}catch(a){}}a.exports=c},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a)}return d(a,[{key:"get",value:function(a){throw new Error("Storage#value is not implemented yet")}},{key:"set",value:function(a,b){throw new Error("Storage#add is not implemented yet")}}]),a}();a.exports=e},function(a,b){"use strict";var c={isCORSSupported:function(){return!!this._getXHR("https://yandex.ru","GET",!0)},_getXHR:function(a,b,c){var d=void 0;if("undefined"!=typeof XMLHttpRequest&&(d=new XMLHttpRequest),c)if("withCredentials"in d)try{d.open(b,a,!0),d.withCredentials=!0}catch(e){d=null}else d=null;else d.open(b,a,!0);return d},get:function(a,b,c,d){var e=void 0,f=b?-1===(a||"").indexOf("?")?"?":"&":"";b=b||{};var g=[];for(var h in b)b.hasOwnProperty(h)&&g.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));f+=g.join("&");var i=this._getXHR(a+f,"GET",!d);i||c&&c({error:"CORS not supported"}),i.onreadystatechange=function(){if(e){(new Date).getTime()-e}if(4===i.readyState)if(200===i.status)c&&c(JSON.parse(i.responseText));else{var a;if("number"==typeof i.status||"string"==typeof i.status?(a=i.status,"string"==typeof i.statusText&&(a+=" "+i.statusText)):a="Unknown code",i.responseText)try{var b=JSON.parse(i.responseText);return void(c&&c(b))}catch(d){}c&&c({error:"Error with XHR",errorMessage:a})}},e=(new Date).getTime(),i.send(null)},post:function(a,b,c,d){var e=this._getXHR(a,"POST",!0)||this._getXHR(a,"POST");e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),Object.keys(d||{}).forEach(function(a){e.setRequestHeader(a,d[a])}),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&c&&c(JSON.parse(e.responseText))},e.send(JSON.stringify(b))}};a.exports=c},function(a,b){"use strict";var c=function(){function a(a,b){var c=window.document.createElement("script"),d=!1;c.src=a,c.async=!0;var e=b||g.error;"function"==typeof e&&(c.onerror=function(b){e({url:a,event:b})}),c.onload=c.onreadystatechange=function(){d||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!0,c.onload=c.onreadystatechange=null,c&&c.parentNode&&c.parentNode.removeChild(c))},f||(f=window.document.getElementsByTagName("head")[0]),f.appendChild(c)}function b(a){return encodeURIComponent(a)}function c(c,d,f,h){var i=-1===(c||"").indexOf("?")?"?":"&",j=void 0;h=h||g.callbackName||"callback";var k="metabar_"+h+"_json"+ ++e;d=d||{};for(j in d)d.hasOwnProperty(j)&&(i+=b(j)+"="+b(d[j])+"&");return window[k]=function(a){f(a);try{delete window[k]}catch(b){}window[k]=null},a(c+i+h+"="+k),k}function d(a){g=a}var e=0,f=void 0,g={};return{get:c,init:d}}();a.exports=c},function(a,b){"use strict";var c={defaults:function(a,b){if(a=a||{},b&&"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&(a[c]=b[c]);return a}};a.exports=c}]);